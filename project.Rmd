---
title: "R Notebook"
output: html_notebook
---

# Observational Study of Historical Behavior of Interest and Inflation Rates in Brazil and USA

## Introduction:

## Methodology:

## Conclusion:

### Importing libraries
```{r}
library("tidyverse") #Manipulate Data
library("ggplot2") #Library for Data Visualization
library('readxl') #Read data from excel
library('GetBCBData') #Library to help to collect data from the BCB API (Central Bank of Brazil)
```
## Collecting USA Data

This excel files were downloaded from the FRED database of economical and financial data from USA.
[ADD DESCRIPTION OF THE DATA, SEARCH IF FROM THE FRED WEBSITE]
### Important notes:
+ The CPI is an index, to compute the annualized inflation rate, we need to compute (cpi_t12/cpi_0), since we have monthly data.
+ The interest rate is already annnualized

CPI: The Consumer Price Index for All Urban Consumers (CPIAUCSL) is a measure of inflation and the buying habits of urban consumers. It includes prices for food, clothing, shelter, transportation, services, and sales taxes. The index is calculated by averaging price changes with weights representing their importance in consumer spending. 


https://fred.stlouisfed.org/series/FEDFUNDS LINK interest rate
https://fred.stlouisfed.org/series/CPIAUCSL LINK inflation rate
```{r}
# https://fred.stlouisfed.org/series/FEDFUNDS for description
cpi_us = read_excel('raw_data/CPIAUCSL.xls', skip = 10)
interest_rate_us = read_excel('raw_data/FEDFUNDS.xls', skip = 10)
cpi_us <- cpi_us %>%
  mutate(inflation_rate_annual =  CPIAUCSL/lag(CPIAUCSL, 12)-1 )# %>% LATER WHEN WE DECIDE TO COMPUTE THE CHANGE
  #mutate(change_inflation = (inflation_rate_annual-lag(inflation_rate_annual)))

inflation_rate_us <- cpi_us[c('observation_date', 'inflation_rate_annual')]

#Merge both databases
data_us <- merge(interest_rate_us, inflation_rate_us,by="observation_date")
colnames(data_us) <- c('observation_date', 'interest_us', 'inflation_us')

data_us$interest_us <- data_us$interest_us/100

data_us
```

## Collecting Brazil Data
We will collect the CDI from Brazil as an proxy of the interest rate, and the IPCA which is a proxy of the Brazillian CPI. We will use a library to help us collect the data from the BCB API.
```{r}

#IPCA its brazillian CPI, it comes in monthly rate
brazil_cpi <- GetBCBData::gbcbd_get_series(
id = 433)
# TO ANNUALIZE THE DATA and save it in decimal format
brazil_cpi$value <- (brazil_cpi$value/100+1)^12-1 #To convert the data into annualized IPCA

# overnight rate in brazil annulized (base 252)
brazil_interest_rate <- GetBCBData::gbcbd_get_series(
id = 4389)
brazil_interest_rate$value <- brazil_interest_rate$value/100 #save it in decimal format

#merge both dataframes
data_br <- merge(brazil_interest_rate[c('ref.date','value')],brazil_cpi[c('ref.date','value')],by="ref.date")

colnames(data_br) <- c('observation_date', 'interest_brazil', 'inflation_brazil')

head(data_br)
```

## Descriptive Stats

```{r}
subset_us <- colnames(data_us)[-1]
subset_br <- colnames(data_br)[-1]

summary(data_us[subset_us])
summary(data_br[subset_br])
```
## Boxplot Data
```{r}
labels <- c(
  replicate(length(data_us$interest_us), 'Interest'),
  replicate(length(data_us$inflation_us), 'Inflation'),
  replicate(length(data_br$interest_br), 'Interest'),
  replicate(length(data_br$inflation_br), 'Inflation')
)

values <- c(
  data_us$interest_us, 
  data_us$inflation_us,
  data_br$interest_br,
  data_br$inflation_br
)

country <- c(
  replicate(length(data_us$interest_us)*2, 'USA'),
  replicate(length(data_br$interest_br)*2, 'Brazil')
)

boxplot_data <- data.frame(
  value =  values,
  category = labels,
  Country = country
)

ggplot(boxplot_data, aes(x=category, y=value, fill=category)) +
  geom_boxplot() + 
  labs(
    y = 'Annualized Rate',
    x = 'Category',
    title = 'Destribution of Interest and Inflation Rates by Country'
  ) +
  scale_y_continuous(labels = scales::percent) +
  facet_grid(. ~ Country)
```

Save the data_frame in a xlsx file
```{r}
#library("writexl")
#write_xlsx(data,"merged_data.xlsx")
```

## Time Series for both Countries

Merge Data
```{r}

ggplot(data=data_br, aes(observation_date)) +
  #geom_line(aes(y = inflation_us, colour = "Inflation Rate USA"))+
  #geom_line(aes(y = interest_us, colour = "Interest Rate USA")) +
  geom_line(aes(y = interest_brazil, colour = "Interest Rate Brazil")) +
  geom_line(aes(y = inflation_brazil, colour = "Inflation Rate Brazil"))+
  ggtitle("Interest and Inflation Rates Over Time")+
  ylab("Annualized Rate") +
  xlab("Time") +
  scale_y_continuous(labels = scales::percent)
head(time_series)
```


```{r}
library(ggplot2)

ggplot(data=data_us, aes(observation_date)) +
  geom_line(aes(y = inflation_us, colour = "Inflation Rate USA"))+
  geom_line(aes(y = interest_us, colour = "Interest Rate USA")) +
  ggtitle("Interest and Inflation Rates Over Time")+
  ylab("Annualized Rate") +
  xlab("Time") +
  scale_y_continuous(labels = scales::percent)
head(time_series)
```

```{r}
ggplot(data = data_us, aes(x=interest_us, y=inflation_us)) +
  geom_point() +
  ggtitle("Interest and Inflation Rate USA")+
  ylab("Annualized Inflation Rate") +
  xlab("Annualized Interest Rate") +
  scale_y_continuous(labels = scales::percent)+
  scale_x_continuous(labels = scales::percent)

```


```{r}
ggplot(data = data_br, aes(x=interest_brazil, y=inflation_brazil)) +
  geom_point()+
  ggtitle("Interest and Inflation Rate Brazil")+
  ylab("Annualized Inflation Rate") +
  xlab("Annualized Interest Rate") +
  scale_y_continuous(labels = scales::percent)+
  scale_x_continuous(labels = scales::percent)


```
```{r}
quantiles_us <- quantile(data_us$inflation_us)
iqr_ <- quantiles_us[[4]]-quantiles_us[[2]]

max_range =  quantiles_us[[4]] + 1.5*iqr_
min_range = quantiles_us[[2]] - 1.5*iqr_

ggplot(data=data_us, aes(observation_date)) +
  geom_line(aes(y = inflation_us, colour = "Inflation Rate USA"))+
  #geom_line(aes(y = interest_us, colour = "Interest Rate USA")) +
  ggtitle("Interest and Inflation Rates Over Time")+
  ylab("Annualized Rate") +
  xlab("Time") +
  geom_hline(yintercept=max_range, linetype="dashed", 
                color = "blue", size=1) +
  geom_hline(yintercept=min_range, linetype="dashed", 
                color = "blue", size=1) +
  scale_y_continuous(labels = scales::percent) 
 


```

```{r}
quantiles_us <- quantile(data_us$inflation_us)
iqr_ <- quantiles_us[[4]]-quantiles_us[[2]]

max_range =  quantiles_us[[4]] + 1.5*iqr_
min_range = quantiles_us[[2]] - 1.5*iqr_

subset <- data_us %>% filter(inflation_us > max_range)
str(subset$observation_date)

unique(format(subset$observation_date,"%Y"))
```

